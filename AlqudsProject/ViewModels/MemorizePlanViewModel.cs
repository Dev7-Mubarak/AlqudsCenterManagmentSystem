using AlqudsProject.Models;
using System.ComponentModel.DataAnnotations;

namespace AlqudsProject.ViewModels
{

    public class MemorizePlanViewModel
    {
        public int? PlanId { get; set; }

        [Required]
        public int StudentId { get; set; }

        [Required]
        [DataType(DataType.Date)]
        public DateTime StartDate { get; set; }

        [Required]
        [Display(Name = "بداية الحفظ (رقم الصفحة)")]
        public int BeginPage { get; set; }

        [Required]
        [Display(Name = "كمية الحفظ اليومية")]
        public double DailyAmount { get; set; }
        
        // لتحديد إذا في خطة مسبقًا (يعرض الزر تعديل)
        public bool IsEdit => PlanId.HasValue;

        // تفاصيل الخطة اليومية
        public List<DailyMemorizePlanViewModel> DailyDetails { get; set; } = new();

        public List<DailyMemorizePlan> GenerateDailyPlan(DateTime endDate)
        {
            var result = new List<DailyMemorizePlan>();
            double currentPage = BeginPage; // استخدام double لدعم النصف صفحة
            DateTime currentDate = StartDate.Date;
            var pageToSurahMap = GetPageSurahDictionary();

            while (currentPage <= 604 && currentDate <= endDate)
            {
                // **تخطي يوم الجمعة**
                if (currentDate.DayOfWeek == DayOfWeek.Friday)
                {
                    currentDate = currentDate.AddDays(1);
                    continue;
                }

                int from = (int)Math.Ceiling(currentPage); // تأكيد أن الرقم صفحة كاملة
                int to = Math.Min(from + (int)Math.Floor(DailyAmount) - 1, 604); // تأكيد أن الصفحة لا تتجاوز 604

                // هنا نبني نص الكمية حسب العدد
                string amountText;

                if (DailyAmount == 1) // حفظ صفحة كاملة
                {
                    amountText = $"صفحة {from}";
                    result.Add(new DailyMemorizePlan
                    {
                        Day = GetArabicDayName(currentDate),
                        Date = currentDate,
                        FromPage = from,
                        ToPage = from,
                        Surah = pageToSurahMap.ContainsKey(from) ? pageToSurahMap[from] : "غير معروفة",
                        Amount = amountText
                    });

                    currentPage += 1; // زيادة الصفحة بحجم 1
                }
                else if (DailyAmount == 0.5) // حفظ نصف صفحة
                {
                    amountText = $"نصف صفحة {from}";
                    // إضافة نصف الصفحة في اليوم الأول
                    result.Add(new DailyMemorizePlan
                    {
                        Day = GetArabicDayName(currentDate),
                        Date = currentDate,
                        FromPage = from,
                        ToPage = from, // نفس الصفحة
                        Surah = pageToSurahMap.ContainsKey(from) ? pageToSurahMap[from] : "غير معروفة",
                        Amount = amountText
                    });

                    currentPage += 0.5; // زيادة الصفحة بمقدار نصف
                    currentDate = currentDate.AddDays(1); // إضافة يوم جديد للنصف الثاني
                    continue; // متابعة التكرار دون إضافة نفس اليوم مرتين
                }
                else if (DailyAmount == 2) // حفظ صفحتين
                {
                    amountText = $"من صفحة {from} إلى {from + 1}";
                    result.Add(new DailyMemorizePlan
                    {
                        Day = GetArabicDayName(currentDate),
                        Date = currentDate,
                        FromPage = from,
                        ToPage = from + 1,
                        Surah = pageToSurahMap.ContainsKey(from) ? pageToSurahMap[from] : "غير معروفة",
                        Amount = amountText
                    });

                    currentPage += 2; // زيادة الصفحة بمقدار 2 (صفحتين)
                }
                else if (DailyAmount == 3) // حفظ ثلاث صفحات
                {
                    amountText = $"من صفحة {from} إلى {from + 2}";
                    result.Add(new DailyMemorizePlan
                    {
                        Day = GetArabicDayName(currentDate),
                        Date = currentDate,
                        FromPage = from,
                        ToPage = from + 2,
                        Surah = pageToSurahMap.ContainsKey(from) ? pageToSurahMap[from] : "غير معروفة",
                        Amount = amountText
                    });

                    currentPage += 3; // زيادة الصفحة بمقدار 3 (ثلاث صفحات)
                }
                else if (DailyAmount == 4) // حفظ أربع صفحات
                {
                    amountText = $"من صفحة {from} إلى {from + 3}";
                    result.Add(new DailyMemorizePlan
                    {
                        Day = GetArabicDayName(currentDate),
                        Date = currentDate,
                        FromPage = from,
                        ToPage = from + 3,
                        Surah = pageToSurahMap.ContainsKey(from) ? pageToSurahMap[from] : "غير معروفة",
                        Amount = amountText
                    });

                    currentPage += 4; // زيادة الصفحة بمقدار 4 (أربع صفحات)
                }

                currentDate = currentDate.AddDays(1); // إضافة يوم جديد بعد كل عملية حفظ
            }

            return result;
        }






        private string GetArabicDayName(DateTime date)
        {
            string[] days = {
                "الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة", "السبت" 
            }; 
            return days[(int)date.DayOfWeek]; 
        }

        private Dictionary<int, string> GetPageSurahDictionary() 
        {
            return new Dictionary<int, string> 
            {
                { 1, "الفاتحة" },
                { 2, "البقرة" }, { 3, "البقرة" }, { 4, "البقرة" }, { 5, "البقرة" }, { 6, "البقرة" }, { 7, "البقرة" },
                { 8, "البقرة" }, { 9, "البقرة" }, { 10, "البقرة" }, { 11, "البقرة" }, { 12, "البقرة" }, { 13, "البقرة" },
                { 14, "البقرة" }, { 15, "البقرة" }, { 16, "البقرة" }, { 17, "البقرة" }, { 18, "البقرة" }, { 19, "البقرة" },
                { 20, "البقرة" }, { 21, "البقرة" }, { 22, "البقرة" }, { 23, "البقرة" }, { 24, "البقرة" }, { 25, "البقرة" },
                { 26, "البقرة" }, { 27, "البقرة" }, { 28, "البقرة" }, { 29, "البقرة" }, { 30, "البقرة" }, { 31, "البقرة" },
                { 32, "البقرة" }, { 33, "البقرة" }, { 34, "البقرة" }, { 35, "البقرة" }, { 36, "البقرة" }, { 37, "البقرة" },
                { 38, "البقرة" }, { 39, "البقرة" }, { 40, "البقرة" }, { 41, "البقرة" }, { 42, "البقرة" }, { 43, "البقرة" },
                { 44, "البقرة" }, { 45, "البقرة" }, { 46, "البقرة" }, { 47, "البقرة" }, { 48, "البقرة" }, { 49, "البقرة" },
                { 50, "آل عمران" }, { 51, "آل عمران" }, { 52, "آل عمران" }, { 53, "آل عمران" }, { 54, "آل عمران" },
                { 55, "آل عمران" }, { 56, "آل عمران" }, { 57, "آل عمران" }, { 58, "آل عمران" }, { 59, "آل عمران" },
                { 60, "آل عمران" }, { 61, "آل عمران" }, { 62, "آل عمران" }, { 63, "آل عمران" }, { 64, "آل عمران" },
                { 65, "آل عمران" }, { 66, "آل عمران" }, { 67, "آل عمران" }, { 68, "آل عمران" }, { 69, "آل عمران" },
                { 70, "آل عمران" }, { 71, "آل عمران" }, { 72, "آل عمران" }, { 73, "آل عمران" }, { 74, "آل عمران" },
                { 75, "آل عمران" }, { 76, "آل عمران" },
                { 77, "النساء" }, { 78, "النساء" }, { 79, "النساء" }, { 80, "النساء" }, { 81, "النساء" }, { 82, "النساء" },
                { 83, "النساء" }, { 84, "النساء" }, { 85, "النساء" }, { 86, "النساء" }, { 87, "النساء" }, { 88, "النساء" },
                { 89, "النساء" }, { 90, "النساء" }, { 91, "النساء" }, { 92, "النساء" }, { 93, "النساء" }, { 94, "النساء" },
                { 95, "النساء" }, { 96, "النساء" }, { 97, "النساء" }, { 98, "النساء" }, { 99, "النساء" }, { 100, "النساء" },
                { 101, "النساء" }, { 102, "النساء" }, { 103, "النساء" }, { 104, "النساء" }, { 105, "النساء" },
                { 106, "النساء/المائدة" }, { 107, "المائدة" }, { 108, "المائدة" }, { 109, "المائدة" }, { 110, "المائدة" },
                { 111, "المائدة" }, { 112, "المائدة" }, { 113, "المائدة" }, { 114, "المائدة" }, { 115, "المائدة" },
                { 116, "المائدة" }, { 117, "المائدة" }, { 118, "المائدة" }, { 119, "المائدة" }, { 120, "المائدة" },
                { 121, "المائدة" }, { 122, "المائدة" }, { 123, "المائدة" }, { 124, "المائدة" }, { 125, "المائدة" },
                { 126, "المائدة" }, { 127, "المائدة" },
                { 128, "الأنعام" }, { 129, "الأنعام" }, { 130, "الأنعام" }, { 131, "الأنعام" }, { 132, "الأنعام" },
                { 133, "الأنعام" }, { 134, "الأنعام" }, { 135, "الأنعام" }, { 136, "الأنعام" }, { 137, "الأنعام" },
                { 138, "الأنعام" }, { 139, "الأنعام" }, { 140, "الأنعام" }, { 141, "الأنعام" }, { 142, "الأنعام" },
                { 143, "الأنعام" }, { 144, "الأنعام" }, { 145, "الأنعام" }, { 146, "الأنعام" }, { 147, "الأنعام" },
                { 148, "الأنعام" }, { 149, "الأنعام" }, { 150, "الأنعام" },
                { 151, "الأعراف" }, { 152, "الأعراف" }, { 153, "الأعراف" }, { 154, "الأعراف" }, { 155, "الأعراف" },
                { 156, "الأعراف" }, { 157, "الأعراف" }, { 158, "الأعراف" }, { 159, "الأعراف" }, { 160, "الأعراف" },
                { 161, "الأعراف" }, { 162, "الأعراف" }, { 163, "الأعراف" }, { 164, "الأعراف" }, { 165, "الأعراف" },
                { 166, "الأعراف" }, { 167, "الأعراف" }, { 168, "الأعراف" }, { 169, "الأعراف" }, { 170, "الأعراف" },
                { 171, "الأعراف" }, { 172, "الأعراف" }, { 173, "الأعراف" }, { 174, "الأعراف" }, { 175, "الأعراف" }, { 176, "الأعراف" },
                { 177, "الأنفال" }, { 178, "الأنفال" }, { 179, "الأنفال" }, { 180, "الأنفال" }, { 181, "الأنفال" },
                { 182, "الأنفال" }, { 183, "الأنفال" }, { 184, "الأنفال" }, { 185, "الأنفال" }, { 186, "الأنفال" },
                { 187, "التوبة" }, { 188, "التوبة" }, { 189, "التوبة" }, { 190, "التوبة" }, { 191, "التوبة" },
                { 192, "التوبة" }, { 193, "التوبة" }, { 194, "التوبة" }, { 195, "التوبة" }, { 196, "التوبة" },
                { 197, "التوبة" }, { 198, "التوبة" }, { 199, "التوبة" }, { 200, "التوبة" }, { 201, "التوبة" },
                { 202, "التوبة" }, { 203, "التوبة" }, { 204, "التوبة" }, { 205, "التوبة" }, { 206, "التوبة" },
                { 207, "التوبة" },
                { 208, "يونس" }, { 209, "يونس" }, { 210, "يونس" }, { 211, "يونس" }, { 212, "يونس" },
                { 213, "يونس" }, { 214, "يونس" }, { 215, "يونس" }, { 216, "يونس" }, { 217, "يونس" },
                { 218, "يونس" }, { 219, "يونس" }, { 220, "يونس" }, { 221, "يونس / هود" },
                { 222, "هود" }, { 223, "هود" }, { 224, "هود" }, { 225, "هود" }, { 226, "هود" },
                { 227, "هود" }, { 228, "هود" }, { 229, "هود" }, { 230, "هود" }, { 231, "هود" },
                { 232, "هود" }, { 233, "هود" }, { 234, "هود" }, { 235, "هود / يوسف" },
                { 236, "يوسف" }, { 237, "يوسف" }, { 238, "يوسف" }, { 239, "يوسف" }, { 240, "يوسف" },
                { 241, "يوسف" }, { 242, "يوسف" }, { 243, "يوسف" }, { 244, "يوسف" }, { 245, "يوسف" },
                { 246, "يوسف" }, { 247, "يوسف" }, { 248, "يوسف" },
                { 249, "الرعد" }, { 250, "الرعد" }, { 251, "الرعد" }, { 252, "الرعد" }, { 253, "الرعد" },
                { 254, "الرعد" }, { 255, "الرعد / إبراهيم" },
                { 256, "إبراهيم" }, { 257, "إبراهيم" }, { 258, "إبراهيم" }, { 259, "إبراهيم" }, { 260, "إبراهيم" },
                { 261, "إبراهيم" },
                { 262, "الحجر" }, { 263, "الحجر" }, { 264, "الحجر" }, { 265, "الحجر" }, { 266, "الحجر" },
                { 267, "النحل" }, { 268, "النحل" }, { 269, "النحل" }, { 270, "النحل" }, { 271, "النحل" },
                { 272, " الحجر / النحل" }, { 273, "النحل" }, { 274, "النحل" }, { 275, "النحل" }, { 276, "النحل" },
                { 277, "النحل" }, { 278, "النحل" }, { 279, "النحل" }, { 280, "النحل" }, { 281, "النحل" },
                { 282, "الإسراء" }, { 283, "الإسراء" }, { 284, "الإسراء" }, { 285, "الإسراء" }, { 286, "الإسراء" },
                { 287, "الإسراء" }, { 288, "الإسراء" }, { 289, "الإسراء" }, { 290, "الإسراء" }, { 291, "الإسراء" },
                { 292, "الإسراء" }, { 293, "الإسراء / الكهف" }, { 294, "الكهف" }, { 295, "الكهف" }, { 296, "الكهف" },
                { 297, "الكهف" }, { 298, "الكهف" }, { 299, "الكهف" }, { 300, "الكهف" }, { 301, "الكهف" }, { 302, "الكهف" },
                { 303, "الكهف" }, { 304, "الكهف" }, { 305, "مريم" }, { 306, "مريم" }, { 307, "مريم" }, { 308, "مريم" },
                { 309, "مريم" }, { 310, "مريم" }, { 311, "مريم" }, { 312, "مريم / طه" }, { 313, "طه" }, { 314, "طه" },
                { 315, "طه" }, { 316, "طه" }, { 317, "طه" }, { 318, "طه" }, { 319, "طه" }, { 320, "طه" }, { 321, "طه" },
                { 322, "الأنبياء" }, { 323, "الأنبياء" }, { 324, "الأنبياء" }, { 325, "الأنبياء" }, { 326, "الأنبياء" },
                { 327, "الأنبياء" }, { 328, "الأنبياء" }, { 329, "الأنبياء" }, { 330, "الأنبياء" }, { 331, "الأنبياء" },
                { 332, "الحج" }, { 333, "الحج" }, { 334, "الحج" }, { 335, "الحج" }, { 336, "الحج" },
                { 337, "الحج" }, { 338, "الحج" }, { 339, "الحج" }, { 340, "الحج" }, { 341, "الحج" },
                { 342, "المؤمنون" }, { 343, "المؤمنون" }, { 344, "المؤمنون" }, { 345, "المؤمنون" }, { 346, "المؤمنون" },
                { 347, "المؤمنون" }, { 348, "المؤمنون" }, { 349, "المؤمنون" },{ 350, "النور" }, { 351, "النور" },
                { 352, "النور" }, { 353, "النور" }, { 354, "النور" },{ 355, "النور" }, { 356, "النور" }, { 357, "النور" },
                { 358, "النور" }, { 359, "النور / الفرقان" }, { 360, "الفرقان" }, { 361, "الفرقان" }, { 362, "الفرقان" },
                { 363, "الفرقان" }, { 364, "الفرقان" }, { 365, "الفرقان" }, { 366, "الفرقان" }, { 367, "الشعراء" },
                { 368, "الشعراء" }, { 369, "الشعراء" }, { 370, "الشعراء" }, { 371, "الشعراء" }, { 372, "الشعراء" },
                { 373, "الشعراء" }, { 374, "الشعراء" },{ 375, "الشعراء" }, { 376, "الشعراء" },
                { 377, "النمل" }, { 378, "النمل" }, { 379, "النمل" }, { 380, "النمل" }, { 381, "النمل" },
                { 382, "النمل" }, { 383, "النمل" }, { 384, "النمل" }, { 385, "النمل / القصص" },
                { 386, "القصص" }, { 387, "القصص" }, { 388, "القصص" }, { 389, "القصص" }, { 390, "القصص" },
                { 391, "القصص" }, { 392, "القصص" }, { 393, "القصص" }, { 394, "القصص" }, { 395, "القصص" },
                { 396, "القصص / العنكبوت" }, { 397, "العنكبوت" }, { 398, "العنكبوت" }, { 399, "العنكبوت" },
                { 400, "العنكبوت" }, { 401, "العنكبوت" }, { 402, "العنكبوت" }, { 403, "العنكبوت" },
                { 404, "العنكبوت / الروم" }, { 405, "الروم" }, { 406, "الروم" }, { 407, "الروم" },
                { 408, "الروم" }, { 409, "الروم" }, { 410, "الروم" },{ 411, "لقمان" }, { 412, "لقمان" }, { 413, "لقمان" }, { 414, "لقمان" },
                { 415, "السجدة" }, { 416, "السجدة" }, { 417, "السجدة" },
                { 418, "الاحزاب" }, { 419, "الاحزاب" }, { 420, "الاحزاب" },
                { 421, "الاحزاب" }, { 422, "الاحزاب" }, { 423, "الاحزاب" },
                { 424, "الاحزاب" }, { 425, "الاحزاب" }, { 426, "الاحزاب" },
                { 427, "الاحزاب" },
                { 428, "سبأ" }, { 429, "سبأ" }, { 430, "سبأ" },
                { 431, "سبأ" }, { 432, "سبأ" }, { 433, "سبأ" }, { 434, "فاطر / سبأ" },{ 435, "فاطر" }, { 436, "فاطر" }, { 437, "فاطر" }, { 438, "فاطر" },
                { 439, "فاطر" }, { 440, "فاطر / يس" },
                { 441, "يس" }, { 442, "يس" }, { 443, "يس" }, { 444, "يس" }, { 445, "يس" },
                { 446, "الصافات" }, { 447, "الصافات" }, { 448, "الصافات" },
                { 449, "الصافات" }, { 450, "الصافات" }, { 451, "الصافات" }, { 452, "الصافات" },
                { 453, "ص" }, { 454, "ص" }, { 455, "ص" }, { 456, "ص" }, { 457, "ص" }, { 458, "ص / الزمر" },
                { 459, "الزمر" }, { 460, "الزمر" },
                { 461, "الزمر" }, { 462, "الزمر" }, { 463, "الزمر" },
                { 464, "الزمر" }, { 465, "الزمر" }, { 466, "الزمر" },
                { 467, "الزمر / غافر" }, { 468, "غافر" }, { 469, "غافر" },
                { 470, "غافر" }, { 471, "غافر" }, { 472, "غافر" },
                { 473, "غافر" }, { 474, "غافر" }, { 475, "غافر" },
                { 476, "غافر" }, { 477, "فصلت" }, { 478, "فصلت" },
                { 479, "فصلت" }, { 480, "فصلت" }, { 481, "فصلت" },
                { 482, "فصلت" }, { 483, "الشورى" }, { 484, "الشورى" },
                { 485, "الشورى" }, { 486, "الشورى" }, { 487, "الشورى" },
                { 488, "الشورى" }, { 489, "الشورى / الزخرف" },
                { 490, "الزخرف" }, { 491, "الزخرف" }, { 492, "الزخرف" },
                { 493, "الزخرف" }, { 494, "الزخرف" }, { 495, "الزخرف" },
                { 496, "الدخان" }, { 497, "الدخان" }, { 498, "الدخان" },
                { 499, "الجاثية" }, { 500, "الجاثية" }, { 501, "الجاثية" },
                { 502, "الجاثية / الأحقاف" }, { 503, "الأحقاف" }, { 504, "الأحقاف" },
                { 505, "الأحقاف" }, { 506, "الأحقاف" }, { 507, "محمد" },
                { 508, "محمد" }, { 509, "محمد" }, { 510, "محمد" },
                { 511, "الفتح" }, { 512, "الفتح" }, { 513, "الفتح" },
                { 514, "الفتح" }, { 515, "الفتح / الحجرات" }, { 516, "الحجرات" },
                { 517, "الحجرات" }, { 518, "ق" }, { 519, "ق" }, { 520, "ق / الذاريات" }, { 521, "الذاريات" }, { 522, "الذاريات" },
                { 523, "الذاريات / الطور" }, { 524, "الطور" }, { 525, "الطور" },
                { 526, "النجم" }, { 527, "النجم" }, { 528, "النجم / القمر" },
                { 529, "القمر" }, { 530, "القمر" }, { 531, "القمر / الرحمن" },
                { 532, "الرحمن" }, { 533, "الرحمن" }, { 534, "الرحمن / الواقعة" },
                { 535, "الواقعة" }, { 536, "الواقعة" }, { 537, "الواقعة / الحديد" },
                { 538, "الحديد" }, { 539, "الحديد" }, { 540, "الحديد" }, { 541, "الحديد" },
                { 542, "المجادلة" }, { 543, "المجادلة" }, { 544, "المجادلة" },
                { 545, "المجادلة / الحشر" }, { 546, "الحشر" }, { 547, "الحشر" },
                { 548, "الحشر" }, { 549, "الممتحنة" }, { 550, "الممتحنة" },
                { 551, "الممتحنة / الصف" }, { 552, "الصف" }, { 553, "الجمعة" },
                { 554, "الجمعة / المنافقون" }, { 555, "المنافقون" },
                { 556, "التغابن" }, { 557, "التغابن" }, { 558, "الطلاق" },
                { 559, "الطلاق" }, { 560, "التحريم" }, { 561, "التحريم" },{ 562, "الملك" }, { 563, "الملك" }, { 564, "الملك / القلم" },
                { 565, "القلم" }, { 566, "القلم / الحاقة" }, { 567, "الحاقة" },
                { 568, "الحاقة / المعارج" }, { 569, "المعارج" }, { 570, "المعارج / نوح" },
                { 571, "نوح" }, { 572, "الجن" }, { 573, "الجن" }, { 574, "المزمل" },
                { 575, "المزمل / المدثر" }, { 576, "المدثر" }, { 577, "المدثر / القيامة" },
                { 578, "القيامة / الانسان" }, { 579, "الانسان" }, { 580, "الانسان / المرسلات" },
                { 581, "المرسلات" }, { 582, "النبأ" }, { 583, "النبأ / النازعات" }, { 584, "النازعات" },
                { 585, "عبس" }, { 586, "التكوير" }, { 587, "الانفطار / المطففين" },
                { 588, "المطففين" }, { 589, "الانشقاق" }, { 590, "البروج" },
                { 591, "الطارق / الأعلى" }, { 592, "الأعلى / الغاشية" },
                { 593, "الفجر" }, { 594, "الفجر / البلد" }, { 595, "الشمس / الليل" },
                { 596, "الضحى / الشرح" }, { 597, "التين / العلق" }, { 598, "القدر / البينة" },
                { 599, "الزلزلة / العاديات" }, { 600, "القارعة / التكاثر" },
                { 601, "العصر / الهمزة / الفيل" }, { 602, "قريش / الماعون / الكوثر" },
                { 603, "الكافرون / النصر / المسد" }, { 604, "الاخلاص / الفلق / الناس" }
            }; 
        }
        

    }
}